data.frame(df[,str_detect(as.matrix(df[1,]),"[0-9]")])
})
df=raw[[2]]
df=raw[[3]]
df=raw[[4]]
df=raw[[5]]
View(df)
ret[[1]]%>>View
ret[[1]]>%>View
ret[[1]]%>%View
ret[[16]]%>%View
ret[[1]][5,1]
ret[[1]][5,2]
ret[[1]][6,2]
ret[[1]][7,2]
ret[[1]][8,2]
ret[[2]][8,2]
ret[[3]][8,2]
ret[[4]][8,2]
ret[[5]][8,2]
sapply(ret,'[',1)
raw=ret[c(1,seq(15,21,2))]
x=llply(raw,function(df){
df=df[!(df[,2]%in%c(NA,"")),-1]
rownames(df)=NULL
df=df[which(str_detect(df[,1],"/")),]
df=df[,1:(min(which(str_detect(as.matrix(df)[1,],"%")))-1)]
data.frame(df[,str_detect(as.matrix(df[1,]),"[0-9]")])
})
x[[3]]=x[[3]][,-2]
names(x)=c("2015","2013","2009","2006","2003")
x=ldply(x,function(df){
names(df)=c("date","n",paste0("V",seq(1,ncol(df)-2)))
df$date=as.Date(df$date,"%d/%m/%Y")
df=df%>%mutate_each(funs(as.numeric(as.character(.))),-date)%>%filter(n>10)
df=melt(df,id=c("date","n"),value.name = "mandates")
},.id="election")
x$variable=as.numeric(gsub("V","",x$variable))
x$election=as.numeric(as.character(x$election))
x=left_join(x,results,by=c("variable","election"))
ggplot(x,aes(x=date,y=mandates,colour=party))+geom_line()+facet_wrap(~election,scales="free_x")
Sys.setlocale("LC_ALL", "English")
ret1 <- readHTMLTable(htmlTable,
header=T,
stringsAsFactors=FALSE,
as.data.frame=TRUE,
.Encoding="UTF-8")
ret[[1]][1,1]
ret[[1]][1,2]
Sys.setlocale("LC_ALL", "Hebrew")
ret1 <- readHTMLTable(htmlTable,
header=T,
stringsAsFactors=FALSE,
as.data.frame=TRUE)
ggplot(x,aes(x=date,y=mandates,colour=party))+geom_step()+facet_wrap(~election,scales="free_x")
ret1[[1]][1,1]
ret1[[1]][1,2]
ggplot(x,aes(x=date,y=mandates))+geom_point()+facet_wrap(~party,scales="free_x")
View(x)
x[[1]]%>%View
ret[[1]]%>%View
raw[[1]]%>%View
x=llply(raw,function(df){
df=df[!(df[,2]%in%c(NA,"")),-1]
rownames(df)=NULL
df=df[which(str_detect(df[,1],"/")),]
df=df[,1:(min(which(str_detect(as.matrix(df)[1,],"%")))-1)]
data.frame(df[,str_detect(as.matrix(df[1,]),"[0-9]")])
})
x[[1]]%>%View
x[[1]]=x[[1]][,-2]
x[[3]]=x[[3]][,-2]
x[[1]]%>%View
names(x)=c("2015","2013","2009","2006","2003")
x=ldply(x,function(df){
names(df)=c("date","n",paste0("V",seq(1,ncol(df)-2)))
df$date=as.Date(df$date,"%d/%m/%Y")
df=df%>%mutate_each(funs(as.numeric(as.character(.))),-date)%>%filter(n>10)
df=melt(df,id=c("date","n"),value.name = "mandates")
},.id="election")
View(x)
x$variable=as.numeric(gsub("V","",x$variable))
x$election=as.numeric(as.character(x$election))
x=left_join(x,results,by=c("variable","election"))
ggplot(x,aes(x=date,y=mandates,colour=party))+geom_step()+facet_wrap(~election,scales="free_x")
ggplot(x%>%filter(election=="2015"),aes(x=date,y=mandates))+geom_step()+facet_wrap(~party,scales="free_x")
Sys.setlocale("LC_ALL", "Hebrew")
pkg=c("plyr","dplyr","reshape2","ggplot2","XML","stringr","shiny","shinyapps")
sapply(pkg,require,character.only = T,warn.conflicts = F,quietly = T)
rm(pkg)
runApp("C:\\Users\\yoni\\Documents\\GitHub\\Elections")
runApp("C:\\Users\\yoni\\Documents\\GitHub\\Elections")
runApp("C:\\Users\\yoni\\Documents\\GitHub\\Elections")
runApp("C:\\Users\\yoni\\Documents\\GitHub\\Elections")
runApp("C:\\Users\\yoni\\Documents\\GitHub\\Elections")
runApp("C:\\Users\\yoni\\Documents\\GitHub\\Elections")
runApp("C:\\Users\\yoni\\Documents\\GitHub\\Elections")
runApp("C:\\Users\\yoni\\Documents\\GitHub\\Elections")
runApp("C:\\Users\\yoni\\Documents\\GitHub\\Elections")
runApp("C:\\Users\\yoni\\Documents\\GitHub\\Elections")
runApp("C:\\Users\\yoni\\Documents\\GitHub\\Elections")
runApp("C:\\Users\\yoni\\Documents\\GitHub\\Elections")
runApp("C:\\Users\\yoni\\Documents\\GitHub\\Elections")
runApp("C:\\Users\\yoni\\Documents\\GitHub\\Elections")
runApp("C:\\Users\\yoni\\Documents\\GitHub\\Elections")
runApp("C:\\Users\\yoni\\Documents\\GitHub\\Elections",launch.browser = T)
list(png="PNG",pdf="PDF")
list("PNG"=png,pdf="PDF")
a=c(3,3)
split(a)
split(a[1],a[2])
split(c("pdf","png"),c("PDF","PNG"))
list(png="PNG",pdf="PDF")
runApp("C:\\Users\\yoni\\Documents\\GitHub\\Elections")
runApp("C:\\Users\\yoni\\Documents\\GitHub\\Elections")
runApp("C:\\Users\\yoni\\Documents\\GitHub\\Elections")
runApp("C:\\Users\\yoni\\Documents\\GitHub\\Elections",launch.browser = T)
runApp("C:\\Users\\yoni\\Documents\\GitHub\\Elections",launch.browser = T)
runApp("C:\\Users\\yoni\\Documents\\GitHub\\Elections",launch.browser = T)
runApp("C:\\Users\\yoni\\Documents\\GitHub\\Elections",launch.browser = T)
runApp("C:\\Users\\yoni\\Documents\\GitHub\\Elections")
0.45*23
.045*23
.955*23
x=read.csv(file="C://Users//yoni//Documents//GitHub//Elections//election_data.csv")
View(x)
x$sample[1]
x$Sample[1]
1/sqrt(x$Sample[1])
ggplot(x%>%filter(Election==2015),aes(x=Date,y=Mandates))+geom_line()+facet_wrap(~Party)
ggplot(x%>%filter(Election==2015),aes(x=as.Date(Date),y=Mandates))+geom_line()+facet_wrap(~Party)
1/sqrt(x$Sample[1])
(1-1/sqrt(x$Sample[1]))*x$Mandates[1]
(1+1/sqrt(x$Sample[1]))*x$Mandates[1]
ggplot(x%>%filter(Election==2015),aes(x=as.Date(Date),y=Mandates))+
geom_line()+facet_wrap(~Party)+geom_ribbon(aes(ymin=(1-sqrt(Sample))*Mandates,ymax=(1+sqrt(Sample))*Mandates),alpha=.25)
ggplot(x%>%filter(Election==2015),aes(x=as.Date(Date),y=Mandates,colour=Party))+
geom_line()+facet_wrap(~Party,"free_y")+geom_ribbon(aes(ymin=(1-sqrt(Sample))*Mandates,
ymax=(1+sqrt(Sample))*Mandates),alpha=.25)
ggplot(x%>%filter(Election==2015),aes(x=as.Date(Date),y=Mandates,colour=Party))+
geom_line()+facet_wrap(~Party,"free_y")+
geom_ribbon(aes(ymin=(1-sqrt(Sample))*Mandates,ymax=(1+sqrt(Sample))*Mandates),alpha=.25)
ggplot(x%>%filter(Election==2015),aes(x=as.Date(Date),y=Mandates,colour=Party))+
geom_line()+facet_wrap(~Party,scales="free_y")+
geom_ribbon(aes(ymin=(1-sqrt(Sample))*Mandates,ymax=(1+sqrt(Sample))*Mandates),alpha=.25)
ggplot(x%>%filter(Election==2015),aes(x=as.Date(Date),y=Mandates,colour=Party))+
geom_line()+facet_wrap(~Party,scales="free_y")+
geom_ribbon(aes(ymin=(1-sqrt(Sample))*Mandates,ymax=(1+sqrt(Sample))*Mandates,fill=Party),alpha=.25)
ggplot(x%>%filter(Election==2015),aes(x=as.Date(Date),y=Mandates,colour=Party))+
geom_line()+facet_wrap(~Party,scales="free_x")+
geom_ribbon(aes(ymin=(1-1/sqrt(Sample))*Mandates,ymax=(1+1/sqrt(Sample))*Mandates,fill=Party),alpha=.25)
ggplot(x%>%filter(Election==2015),aes(x=as.Date(Date),y=Mandates,colour=Party))+
geom_step()+facet_wrap(~Party,scales="free_x")+
geom_ribbon(aes(ymin=(1-1/sqrt(Sample))*Mandates,ymax=(1+1/sqrt(Sample))*Mandates,fill=Party),alpha=.25)
library(proto)
stairstepn <- function( data, direction="hv", yvars="y" ) {
direction <- match.arg( direction, c( "hv", "vh" ) )
data <- as.data.frame( data )[ order( data$x ), ]
n <- nrow( data )
if ( direction == "vh" ) {
xs <- rep( 1:n, each = 2 )[ -2 * n ]
ys <- c( 1, rep( 2:n, each = 2 ) )
} else {
ys <- rep( 1:n, each = 2 )[ -2 * n ]
xs <- c( 1, rep( 2:n, each = 2))
}
data.frame(
x = data$x[ xs ]
, data[ ys, yvars, drop=FALSE ]
, data[ xs, setdiff( names( data ), c( "x", yvars ) ), drop=FALSE ]
)
}
stat_stepribbon <- function( mapping=NULL, data=NULL, geom="ribbon", position="identity" ) {
StatStepribbon$new( mapping=mapping, data=data, geom=geom, position=position )
}
StatStepribbon <- proto(ggplot2:::Stat, {
objname <- "stepribbon"
desc <- "Stepwise area plot"
desc_outputs <- list(
x = "stepped independent variable",
ymin = "stepped minimum dependent variable",
ymax = "stepped maximum dependent variable"
)
required_aes <- c( "x", "ymin", "ymax" )
default_geom <- function(.) GeomRibbon
default_aes <- function(.) aes( x=..x.., ymin = ..y.., ymax=Inf )
calculate <- function( ., data, scales, direction = "hv", yvars = c( "ymin", "ymax" ), ...) {
stairstepn( data = data, direction = direction, yvars = yvars )
}
examples <- function(.) {
DF <- data.frame( x = 1:3, ymin = runif( 3 ), ymax=rep( Inf, 3 ) )
ggplot( DF, aes( x=x, ymin=ymin, ymax=ymax ) ) + stat_stepribbon()
}
})
dta <- read.table( text=
"Indep   Dep   DepLim
0        0.5   2
1        1.5   Inf
2        2.5   Inf
", header=TRUE, as.is=TRUE )
limmaxy <- 3
ggplot( dta, aes( x=Indep, y=Dep ) ) +
geom_step( size=2, direction="hv" ) +
geom_ribbon( aes( x=Indep, ymin=Dep, ymax=DepLim ), stat="stepribbon", fill="blue", alpha=0.3, direction="hv" ) +
coord_cartesian( ylim=c( 0, limmaxy ) )
p=ggplot(x%>%filter(Election==2015),aes(x=as.Date(Date),y=Mandates,colour=Party))+
geom_step()+facet_wrap(~Party,scales="free_x")+
geom_ribbon(stat="stepribbon",aes(ymin=(1-1/sqrt(Sample))*Mandates,ymax=(1+1/sqrt(Sample))*Mandates,fill=Party),alpha=.25)
p
p=ggplot(x%>%filter(Election==2015),aes(x=as.Date(Date),y=Mandates,colour=Party))+
geom_step()+facet_wrap(~Party,scales="free")+
geom_ribbon(stat="stepribbon",aes(ymin=(1-1/sqrt(Sample))*Mandates,ymax=(1+1/sqrt(Sample))*Mandates,fill=Party),alpha=.25)
p
x%>%select(Party,Partyid)%>%distinct%>%View
ggplot(x%>%filter(Election==2015&Partyid==5),aes(x=as.Date(Date),y=Mandates,colour=Party))+
geom_step()+facet_wrap(~Party,scales="free")+
geom_ribbon(stat="stepribbon",aes(ymin=(1-1/sqrt(Sample))*Mandates,ymax=(1+1/sqrt(Sample))*Mandates,fill=Party),alpha=.25)
x%>%select(Party,Partyid)%>%distinct%>%View
ggplot(x%>%filter(Election==2015&Partyid%in%c(5,7)),
aes(x=as.Date(Date),y=Mandates,colour=Party))+geom_step()+
geom_ribbon(stat="stepribbon",aes(ymin=(1-1/sqrt(Sample))*Mandates,ymax=(1+1/sqrt(Sample))*Mandates,fill=Party),alpha=.25)
ggplot(x%>%filter(Election==2015&Partyid%in%c(5,7)&format(Date,"%Y")==2015),
aes(x=as.Date(Date),y=Mandates,colour=Party))+geom_step()+
geom_ribbon(stat="stepribbon",aes(ymin=(1-1/sqrt(Sample))*Mandates,ymax=(1+1/sqrt(Sample))*Mandates,fill=Party),alpha=.25)
ggplot(x%>%filter(Election==2015&Partyid%in%c(5,7)&format(as.Date(Date),"%Y")==2015),
aes(x=as.Date(Date),y=Mandates,colour=Party))+geom_step()+
geom_ribbon(stat="stepribbon",aes(ymin=(1-1/sqrt(Sample))*Mandates,ymax=(1+1/sqrt(Sample))*Mandates,fill=Party),alpha=.25)
ggplot(x%>%filter(Election==2015&Partyid%in%c(5,7)&format(as.Date(Date),"%Y")==2015),
aes(x=as.Date(Date),y=Mandates,colour=Party))+geom_line()+
geom_ribbon(aes(ymin=(1-1/sqrt(Sample))*Mandates,ymax=(1+1/sqrt(Sample))*Mandates,fill=Party),alpha=.25)
ggplot(x%>%filter(Election==2015&Partyid%in%c(5,7)&format(as.Date(Date),"%Y")==2015),
aes(x=as.Date(Date),y=Mandates,colour=Party))+geom_point()+
geom_ribbon(aes(ymin=(1-1/sqrt(Sample))*Mandates,ymax=(1+1/sqrt(Sample))*Mandates,fill=Party),alpha=.25)
ggplot(x%>%filter(Election==2015&Partyid%in%c(5,7)&format(as.Date(Date),"%Y")==2015),
aes(x=as.Date(Date),y=Mandates,colour=Party))+geom_point()+
geom_ribbon(stat="stepribbon",aes(ymin=(1-1/sqrt(Sample))*Mandates,ymax=(1+1/sqrt(Sample))*Mandates,fill=Party),alpha=.25)
ggplot(x%>%filter(Election==2015&Partyid%in%c(5,7)&format(as.Date(Date),"%Y")==2015),
aes(x=as.Date(Date),y=Mandates,colour=Party))+geom_point()+
geom_errorbar(aes(ymin=(1-1/sqrt(Sample))*Mandates,ymax=(1+1/sqrt(Sample))*Mandates,fill=Party),alpha=.25)
ggplot(x%>%filter(Election==2015&Partyid%in%c(5,7)&format(as.Date(Date),"%Y")==2015),
aes(x=as.Date(Date),y=Mandates,colour=Party))+geom_point()+
geom_errorbar(aes(ymin=(1-1/sqrt(Sample))*Mandates,ymax=(1+1/sqrt(Sample))*Mandates))
ggplot(x%>%filter(Election==2015&Partyid%in%c(5,7)&format(as.Date(Date),"%Y")==2015),
aes(x=as.Date(Date),y=Mandates,colour=Party))+geom_point()+
geom_errorbar(aes(ymin=(1-1/sqrt(Sample))*Mandates,ymax=(1+1/sqrt(Sample))*Mandates),linetype=2)
ggplot(x%>%filter(Election==2015&Partyid%in%c(5,7)&format(as.Date(Date),"%Y")==2015),
aes(x=as.Date(Date),y=Mandates,colour=Party))+geom_point()+
geom_errorbar(aes(ymin=(1-1/sqrt(Sample))*Mandates,ymax=(1+1/sqrt(Sample))*Mandates),linetype=3)
ggplot(x%>%filter(Election==2015&Partyid%in%c(5,7)&format(as.Date(Date),"%Y")==2015),
aes(x=as.Date(Date),y=Mandates,colour=Party))+geom_point()+facet_wrap(~Party,scales="free")
geom_errorbar(aes(ymin=(1-1/sqrt(Sample))*Mandates,ymax=(1+1/sqrt(Sample))*Mandates))
ggplot(x%>%filter(Election==2015&Partyid%in%c(5,7)&format(as.Date(Date),"%Y")==2015),
aes(x=as.Date(Date),y=Mandates,colour=Party))+geom_point()+facet_wrap(~Party,scales="free")+
geom_errorbar(aes(ymin=(1-1/sqrt(Sample))*Mandates,ymax=(1+1/sqrt(Sample))*Mandates))
Sys.Date()
require(devtools)
require(devtools)
install_github('poirot', 'ramnathv')
install_github('ramnathv/poirot')
install_github('ramnathv/slidify', ref = 'dev')
install_github('slidifyLibraries', 'ramnathv')
install_github('ramnathv/poirot')
library("poirot", lib.loc="~/R/win-library/3.1")
library(yaml)
install.packages("R2HTML")
library(R2HTML)
library("rmarkdown", lib.loc="~/R/win-library/3.1")
library("markdown", lib.loc="~/R/win-library/3.1")
detach("package:rmarkdown", unload=TRUE)
detach("package:markdown", unload=TRUE)
install.packages("markdown")
install.packages("markdown")
install.packages("rmarkdown")
library("markdown", lib.loc="~/R/win-library/3.1")
library("rmarkdown", lib.loc="~/R/win-library/3.1")
install.packages("slidify")
library("slidify", lib.loc="~/R/win-library/3.1")
setwd("C:\\Users\\yoni\\Documents\\GitHub\\poirotBlog\\posts")
knit2html("galery.Rmd")
library("knitr", lib.loc="~/R/win-library/3.1")
knit2html("galery.Rmd")
knit2html("gallery.Rmd")
library(plyr)
library(dplyr)
library(reshape2)
library(XML)
library(stringr)
library(ggplot2)
library(httr)
loc.run="windows-1255"
x.old=read.csv("election_data.csv",stringsAsFactors=F,fileEncoding=loc.run)%>%mutate(Date=as.Date(Date))
attribute=read.csv("election_results.csv",stringsAsFactors=F,fileEncoding=loc.run)
Poll=read.csv("Pollster_En.csv",stringsAsFactors=F,fileEncoding=loc.run)
fac_vars.df=read.csv("fac_vars.csv",stringsAsFactors=F,fileEncoding=loc.run)
setwd("C:\\Users\\yoni\\Documents\\GitHub\\Elections")
x.old=read.csv("election_data.csv",stringsAsFactors=F,fileEncoding=loc.run)%>%mutate(Date=as.Date(Date))
attribute=read.csv("election_results.csv",stringsAsFactors=F,fileEncoding=loc.run)
Poll=read.csv("Pollster_En.csv",stringsAsFactors=F,fileEncoding=loc.run)
fac_vars.df=read.csv("fac_vars.csv",stringsAsFactors=F,fileEncoding=loc.run)
Sys.setlocale("LC_ALL", "Hebrew")
x.old=read.csv("election_data.csv",stringsAsFactors=F,fileEncoding=loc.run)%>%mutate(Date=as.Date(Date))
attribute=read.csv("election_results.csv",stringsAsFactors=F,fileEncoding=loc.run)
Poll=read.csv("Pollster_En.csv",stringsAsFactors=F,fileEncoding=loc.run)
fac_vars.df=read.csv("fac_vars.csv",stringsAsFactors=F,fileEncoding=loc.run)
fac_vars=fac_vars.df[,1]
url="https://docs.google.com/spreadsheets/d/1-Xr5gb-HfO08RaP3Y5s6YBs9Uvv0JenZGnvPsqsyBNc/pubhtml?gid=0&single=true"
doc <- content(GET(url),as="text",encoding="UTF-8")
htmlTable <- gsub("^.*?(<table.*</table).*$", "\\1>", doc)
tableNodes = getNodeSet(htmlParse(htmlTable,encoding="UTF-8"), "//table")
ret=readHTMLTable(tableNodes[[1]],header=T,stringsAsFactors=FALSE,
as.data.frame=TRUE,row.names = NULL,encoding="windows-1255")
df=as.data.frame(ret[-1,-1])
names(df)=c(as.character(ret[1,2:6]),paste0("V",seq(1:11)))
df$Date=as.Date(df$Date,"%m/%d/%Y")
df=df%>%mutate_each(funs(as.numeric(as.character(.))),-c(Date,Publisher,Pollster,Type))
df=melt(df,id=names(df)[1:5],value.name = "Mandates",variable.name="Party")%>%
mutate(Party=str_replace_all(as.character(factor(Party,labels=ret[1,7:17])),'\"',""),
Party=str_replace(Party,"××¨×©××× ×××©××ª×¤×ª","×¨×©××× ××©××ª×¤×ª ×¢×¨×××ª"),
Publisher=str_replace_all(Publisher,"!",""),
Election=2015)
x=rbind(df,x.old)%>%filter(!is.na(Mandates))%>%
mutate(Mandate.Group=cut(Mandates,breaks = c(0,1,5,10,15,20,30,50),include.lowest = T))%>%
distinct
simpleCap <- function(x) {
s <- strsplit(x, " ")[[1]]
paste(toupper(substring(s, 1,1)), substring(s, 2),
sep="", collapse=" ")
}
simpleCap <- function(x) {
s <- strsplit(x, " ")[[1]]
paste(toupper(substring(s, 1,1)), substring(s, 2),
sep="", collapse=" ")
}
x$Publisher=sapply(x$Publisher,simpleCap)
x=join(x,attribute,by=c("Election","Party"))
x=left_join(x,Poll%>%select(Publisher,Publisher.En)%>%distinct,by=c("Publisher"))
x=left_join(x,Poll%>%select(Pollster,Pollster.En)%>%distinct,by=c("Pollster"))
x=left_join(x,attribute%>%group_by(Election,Party)%>%filter(row_number(Party)==1)%>%count(Election)%>%ungroup,
by="Election")%>%rename(N=n)%>%mutate(Error=Mandates-Results,week=format(Date,"%w"),month=format(Date,"%m"),year=format(Date,"%Y"))%>%
arrange(desc(Date),Election,Publisher,desc(Mandates))%>%ungroup
x=x%>%mutate(Partyid=as.numeric(factor(str_trim(Party))),
Pollsterid=as.numeric(factor(str_trim(Pollster))),
Publisherid=as.numeric(factor(str_trim(Publisher))),
Election.Date=as.Date(factor(Election,labels=c("2003-01-28","2006-03-28","2009-02-10","2013-01-22","2015-03-17"))),
DaysLeft=as.numeric(Election.Date-Date),
Sample.Error=1/sqrt(Sample),
Mandates.lb=floor(Mandates*(1-Sample.Error)),
Mandates.ub=floor(Mandates*(1+Sample.Error)))
x$Party%>%unique%>%View
x=rbind(df,x.old)%>%filter(!is.na(Mandates))%>%
mutate(Mandate.Group=cut(Mandates,breaks = c(0,1,5,10,15,20,30,50),include.lowest = T))%>%
distinct
x$Publisher=sapply(x$Publisher,simpleCap)
x=join(x,attribute,by=c("Election","Party"))
x=left_join(x,Poll%>%select(Publisher,Publisher.En)%>%distinct,by=c("Publisher"))
x=left_join(x,Poll%>%select(Pollster,Pollster.En)%>%distinct,by=c("Pollster"))
x=left_join(x,attribute%>%group_by(Election,Party)%>%filter(row_number(Party)==1)%>%count(Election)%>%ungroup,
by="Election")%>%rename(N=n)%>%mutate(Error=abs(Mandates-Results),week=format(Date,"%w"),month=format(Date,"%m"),year=format(Date,"%Y"))%>%
arrange(desc(Date),Election,Publisher,desc(Mandates))%>%ungroup
View(x%>%head)
x%>%filter(Election==2003)%>%head%>%View
x%>%filter(Election==2003)%>%group_by(Pollster,Date)%>%summarise(PollErr=sqrt(sum(Error^2)))
x%>%filter(Election==2003)%>%group_by(Pollster,Date)%>%summarise(PollErr=sqrt(sum(Error^2)))%>%View
x%>%filter(Election==2003)%>%group_by(Pollster,Date)%>%summarise(PollErr=round(sqrt(sum(Error^2))))%>%View
x%>%group_by(Pollster,Date)%>%summarise(PollErr=round(sqrt(sum(Error^2))))%>%View
x%>%group_by(Pollster,Date)%>%summarise(PollErr=round(sqrt(sum(Error^2,na.rm = T))))%>%View
x=rbind(df,x.old)%>%filter(!is.na(Mandates))%>%
mutate(Mandate.Group=cut(Mandates,breaks = c(0,1,5,10,15,20,30,50),include.lowest = T))%>%
distinct
x$Publisher=sapply(x$Publisher,simpleCap)
x=join(x,attribute,by=c("Election","Party"))
x=left_join(x,Poll%>%select(Publisher,Publisher.En)%>%distinct,by=c("Publisher"))
x=left_join(x,Poll%>%select(Pollster,Pollster.En)%>%distinct,by=c("Pollster"))
x=left_join(x,attribute%>%group_by(Election,Party)%>%filter(row_number(Party)==1)%>%count(Election,Pollster)%>%ungroup,
by="Election")%>%rename(N=n)%>%mutate(Error=abs(Mandates-Results),week=format(Date,"%w"),month=format(Date,"%m"),year=format(Date,"%Y"))%>%
arrange(desc(Date),Election,Publisher,desc(Mandates))%>%ungroup
x=left_join(x,x%>%count(Election,Pollster),by="Election")%>%
rename(N=n)%>%mutate(Error=abs(Mandates-Results),week=format(Date,"%w"),month=format(Date,"%m"),year=format(Date,"%Y"))%>%
arrange(desc(Date),Election,Publisher,desc(Mandates))%>%ungroup
View(x)
x=rbind(df,x.old)%>%filter(!is.na(Mandates))%>%
mutate(Mandate.Group=cut(Mandates,breaks = c(0,1,5,10,15,20,30,50),include.lowest = T))%>%
distinct
x$Publisher=sapply(x$Publisher,simpleCap)
x=join(x,attribute,by=c("Election","Party"))
x=left_join(x,Poll%>%select(Publisher,Publisher.En)%>%distinct,by=c("Publisher"))
x=left_join(x,Poll%>%select(Pollster,Pollster.En)%>%distinct,by=c("Pollster"))
x=left_join(x,x%>%count(Election,Pollster),by=c("Election","POllster"))%>%
rename(N=n)%>%mutate(Error=abs(Mandates-Results),week=format(Date,"%w"),month=format(Date,"%m"),year=format(Date,"%Y"))%>%
arrange(desc(Date),Election,Publisher,desc(Mandates))%>%ungroup
View(x)
x=left_join(x,x%>%count(Election,Pollster),by=c("Election","Pollster"))%>%
rename(N=n)%>%mutate(Error=abs(Mandates-Results),week=format(Date,"%w"),month=format(Date,"%m"),year=format(Date,"%Y"))%>%
arrange(desc(Date),Election,Publisher,desc(Mandates))%>%ungroup
x%>%count(Election,Pollster)
x%>%select(Election,Pollster)
x%>%count(Election,Pollster,Date)
x%>%select(Election,Pollster,Date)%>%unique
x%>%select(Election,Pollster,Date)%>%unique%>%count(Election,Pollster)
x=rbind(df,x.old)%>%filter(!is.na(Mandates))%>%
mutate(Mandate.Group=cut(Mandates,breaks = c(0,1,5,10,15,20,30,50),include.lowest = T))%>%
distinct
x$Publisher=sapply(x$Publisher,simpleCap)
x=join(x,attribute,by=c("Election","Party"))
x=left_join(x,Poll%>%select(Publisher,Publisher.En)%>%distinct,by=c("Publisher"))
x=left_join(x,Poll%>%select(Pollster,Pollster.En)%>%distinct,by=c("Pollster"))
x=left_join(x,x%>%select(Election,Pollster,Date)%>%unique%>%count(Election,Pollster),by=c("Election","Pollster"))%>%
rename(N=n)%>%mutate(Error=abs(Mandates-Results),week=format(Date,"%w"),month=format(Date,"%m"),year=format(Date,"%Y"))%>%
arrange(desc(Date),Election,Publisher,desc(Mandates))%>%ungroup
View(x)
x%>%filter(Election=2003)%>%View
x%>%filter(Election==2003)%>%View
x%>%group_by(Pollster,Date)%>%summarise(PollErr=round(sqrt(sum(Error^2,na.rm = T))))%>%View
x%>%filter(Election==2003)%>%group_by(Pollster,Date)%>%summarise(PollErr=round(sqrt(sum(Error^2,na.rm = T))))%>%View
x%>%filter(Election==2003)%>%group_by(Pollster,Date,N)%>%summarise(PollErr=round(sqrt(sum(Error^2,na.rm = T))))%>%View
left_join(x%>%filter(Election==2003)%>%group_by(Pollster,Date)%>%summarise(PollErr=round(sqrt(sum(Error^2,na.rm = T)))),x%>%select(Election,Pollster,Date)%>%unique%>%count(Election,Pollster),by=c("Election","Pollster"))
left_join(x%>%filter(Election==2003)%>%group_by(Election,Pollster,Date)%>%summarise(PollErr=round(sqrt(sum(Error^2,na.rm = T)))),x%>%select(Election,Pollster,Date)%>%unique%>%count(Election,Pollster),by=c("Election","Pollster"))
left_join(x%>%filter(Election==2003)%>%group_by(Election,Pollster,Date)%>%summarise(PollErr=round(sqrt(sum(Error^2,na.rm = T)))),x%>%select(Election,Pollster,Date)%>%unique%>%count(Election,Pollster),by=c("Election","Pollster"))%>%View
x1=x%>%filter(Election==2003)%>%group_by(Election,Pollster,Date)%>%summarise(PollErr=round(sqrt(sum(Error^2,na.rm = T))))
x1%>%group_by(Election,Pollster)%>%summarise(mean(PollErr)))
x1%>%group_by(Election,Pollster)%>%summarise(mean(PollErr))
x1=x%>%filter(Election==2003)%>%group_by(Election,Pollster,Date)%>%summarise(PollErr=sqrt(sum(Error^2,na.rm = T)))
x2=x1%>%group_by(Election,Pollster)%>%summarise(mean(PollErr))
x2
x1=x%>%filter(Election!=2015)%>%group_by(Election,Pollster,Date)%>%summarise(PollErr=sqrt(sum(Error^2,na.rm = T)))%>%group_by(Election,Pollster)%>%summarise(mean(PollErr))
x1%>%View
x1=x%>%filter(Election!=2015)%>%group_by(Election,Pollster,Date)%>%summarise(PollErr=sqrt(sum(Error^2,na.rm = T)))%>%group_by(Election,Pollster)%>%summarise(PollErr=mean(PollErr))
x1%>%View
ggplot(x1,aes(x=Election,y=PollErr,fill=Pollster))+geom_bar(position="dodge",stat="identity")
ggplot(x1,aes(x=Pollster,y=PollErr,fill=Pollster))+geom_boxplot()
ggplot(x1,aes(x=Pollster,y=PollErr,fill=Pollster))+geom_boxplot()+facet_wrap(~Election)
ggplot(x1,aes(x=Pollster,y=PollErr,fill=Pollster))+geom_bar(position="dodge",stat="identity")+facet_wrap(~Election)
ggplot(x1,aes(x=Pollster,y=PollErr,fill=Pollster))+geom_bar(position="dodge",stat="identity")+facet_wrap(~Election,scales="free_x")
x1=x%>%filter(Election!=2015)%>%group_by(Election,Pollster,Date)%>%summarise(PollErr=sqrt(sum(Error^2,na.rm = T)))%>%group_by(Election,Pollster)
x2=x1%>%summarise(PollErr=mean(PollErr))
x1=x%>%filter(Election!=2015)%>%group_by(Election,Pollster,Date)%>%summarise(PollErr=sqrt(sum(Error^2,na.rm = T)))
x2=x1%>%group_by(Election,Pollster)%>%summarise(PollErr=mean(PollErr))
ggplot(x1,aes(x=Pollster,y=PollErr,fill=Pollster))+geom_boxplot()+facet_wrap(~Election,scales="free_x")
ggplot(x1,aes(x=Pollster,y=PollErr,fill=Pollster))+
geom_boxplot()+facet_wrap(~Election,scales="free_x")+theme_bw()+
theme(axis.text.x = element_text(angle = 90))
ggplot(x1,aes(x=Election,y=PollErr,fill=Election))+
geom_boxplot()+facet_wrap(~Pollster,scales="free_x")+theme_bw()
ggplot(x1,aes(x=Election,y=PollErr,fill=factor(Election)))+
geom_boxplot()+facet_wrap(~Pollster,scales="free_x")+theme_bw()
theme(axis.text.x = element_text(angle = 90))
ggplot(x1%>%mutate(Election=factor(Election)),aes(x=Election,y=PollErr,fill=Election))+
geom_boxplot()+facet_wrap(~Pollster,scales="free_x")+theme_bw()
ggplot(x1%>%ungroup%>%mutate(Election=factor(Election)),aes(x=Election,y=PollErr,fill=Election))+
geom_boxplot()+facet_wrap(~Pollster,scales="free_x")+theme_bw()
Pollster_Party_Error=x%>%filter(Election!=2015)%>%group_by(Election,Pollster,Party,Date)%>%summarise(PollErr=sqrt(sum(Error^2,na.rm = T)))
Pollster_Error_Part_Mean=x1%>%group_by(Election,Pollster,Party)%>%summarise(PollErr=mean(PollErr))
Pollster_Error_Party_Mean=Pollster_Party_Error%>%group_by(Election,Pollster,Party)%>%summarise(PollErr=mean(PollErr))
View(Pollster_Party_Error)
Pollster_Party_Error_Mean=Pollster_Party_Error%>%group_by(Election,Pollster,Party)%>%summarise(PollErr=mean(PollErr))
View(Pollster_Party_Error_Mean)
View(Pollster_Party_Error_Mean)
Pollster_Party_Error_Mean=Pollster_Party_Error%>%group_by(Election,Pollster,Party)%>%summarise(PollPartyErr=mean(PollErr))
View(Pollster_Party_Error_Mean)
x=rbind(df,x.old)%>%filter(!is.na(Mandates))%>%
mutate(Mandate.Group=cut(Mandates,breaks = c(0,1,5,10,15,20,30,50),include.lowest = T))%>%
distinct
x$Publisher=sapply(x$Publisher,simpleCap)
x=join(x,attribute,by=c("Election","Party"))
x=left_join(x,Poll%>%select(Publisher,Publisher.En)%>%distinct,by=c("Publisher"))
x=left_join(x,Poll%>%select(Pollster,Pollster.En)%>%distinct,by=c("Pollster"))
x=left_join(x,x%>%select(Election,Pollster,Date)%>%unique%>%count(Election,Pollster),by=c("Election","Pollster"))%>%
rename(N=n)%>%mutate(Error=Mandates-Results,Error.abs=abs(Mandates-Results),week=format(Date,"%w"),month=format(Date,"%m"),year=format(Date,"%Y"))%>%
arrange(desc(Date),Election,Publisher,desc(Mandates))%>%ungroup
Pollster_Party_Error=x%>%filter(Election!=2015)%>%group_by(Election,Pollster,Party,Date)%>%summarise(PollErr=sum(Error,na.rm = T))
Pollster_Party_Error_Mean=Pollster_Party_Error%>%group_by(Election,Pollster,Party)%>%summarise(PollPartyErr=mean(PollErr))
View(Pollster_Party_Error_Mean)
ggplot(Pollster_Party_Error%>%ungroup%>%mutate(Election=factor(Election)),aes(x=Election,y=PollErr,fill=Party))+
geom_boxplot()+facet_wrap(~Pollster,scales="free_x")+theme_bw()
ggplot(Pollster_Party_Error%>%ungroup%>%mutate(Election=factor(Election)),
aes(x=Election,y=PollErr,fill=Party))
+
geom_boxplot()
ggplot(Pollster_Party_Error%>%ungroup%>%mutate(Election=factor(Election)),
aes(x=Election,y=PollErr,fill=Party))+
geom_boxplot()
ggplot(Pollster_Party_Error%>%ungroup%>%mutate(Election=factor(Election)),
aes(x=Election,y=PollErr,fill=Party))+
geom_boxplot()+facet_wrap(~Election,scales="free_x")+theme_bw()
ggplot(Pollster_Party_Error%>%ungroup%>%mutate(Election=factor(Election)),
aes(x=Party,y=PollErr,fill=Party))+
geom_boxplot()+facet_wrap(~Election,scales="free_x")+theme_bw()
ggplot(Pollster_Party_Error%>%ungroup%>%mutate(Election=factor(Election)),
aes(x=Party,y=PollErr,fill=Party))+geom_boxplot()+facet_wrap(~Election)+theme_bw()
ggplot(Pollster_Party_Error%>%ungroup%>%mutate(Election=factor(Election)),
aes(x=Pollster,y=PollErr,fill=Pollster))+geom_boxplot()+facet_wrap(~Election)+theme_bw()
Pollster_Error=x%>%filter(Election!=2015)%>%group_by(Election,Pollster,Date)%>%summarise(PollErr=sqrt(sum(Error.abs^2,na.rm = T)))
Pollster_Error_Mean=x1%>%group_by(Election,Pollster)%>%summarise(PollErr=mean(PollErr))
Pollster_Party_Error=x%>%filter(Election!=2015)%>%group_by(Election,Pollster,Party,Date)%>%summarise(PollErr=sum(Error,na.rm = T))
Pollster_Party_Error_Mean=Pollster_Party_Error%>%group_by(Election,Pollster,Party)%>%summarise(PollPartyErr=mean(PollErr))
rm(Pollster_Error_Party_Mean)
Pollster_Error_Mean%>%View
c(2003,2006,2009,2013)/20
Pollster_Error_Mean%>%mutate(test=100*PollErr/(Election/20))%>%View
Pollster_Error%>%View
Pollster_Error_Mean%>%View
Pollster_Error%>%count(Pollster)
Pollster_Error%>%count(Election,Pollster)
Pollster_Error%>%count(Election)
left_join(Pollster_Error%>%count(Election,Pollster),Pollster_Error%>%count(Election),by="Election")
left_join(Pollster_Error%>%count(Election,Pollster),Pollster_Error%>%count(Election)%>%rename(ntot=n),by="Election")
left_join(Pollster_Error%>%count(Election,Pollster),Pollster_Error%>%count(Election)%>%rename(ntot=n),by="Election")%>%View
View("יוני")
library("maptools", lib.loc="~/R/win-library/3.1")
library(rgdal)
CRS("+init=epsg:2039")
CRSargs(CRS("+init=epsg:2039"))
